1. Deploy new k8s on AWS:
export KOPS_STATE_STORE=s3://demo.k8s.simpledevops.net
ssh-key OR delete .ssh/known_hosts
kops create cluster --cloud=aws --zones=us-east-1b --name=demo.k8s.simpledevops.net --dns-zone=simpledevops.net --dns private
kops update cluster demo.k8s.simpledevops.net --yes

Modify hosts file in Ansible-server
Copy id_rsa.pub from Ansible 

2. PACKER:
cat create-docker-image.json
{
  "builders": [
    {
      "type": "docker",
      "image": "tomcat:8.0",
      "commit": "true",
      "run_command": [
        "-d",
        "-i",
        "-t",
        "tomcat:8.0"
      ]
    }
  ],

  "provisioners": [
    {
      "type": "shell",
      "inline": [
        "apt-get update",
        "mkdir -p /usr/local/tomcat/webapps"
      ]
    },
    {
      "type": "file",
      "source": "webapp.war",
      "destination": "/usr/local/tomcat/webapps/webapp.war"
    }
  ],

  "post-processors": [
    [
      {
        "type": "docker-tag",
        "repository": "duclpminh/simple-devops-image",
        "tag": "latest"
      },
      {
        "type": "docker-push",
        "login": "true",
        "login_username": "duclpminh",
        "login_password": "Windupbird@94"
      }

    ],
    {
      "type": "shell-local",
      "inline": ["docker image prune -af"]
    }
  ]
}


####################################

On k8s Master:

*k8s-deploy.yml
---
apiVersion: apps/v1 # for versions before 1.9.0 use apps/v1beta2
kind: Deployment
metadata:
  name: simple-devops-deployment
spec:
  selector:
    matchLabels:
      app: simple-devops-project
  replicas: 2 # tells deployment to run 2 pods matching the template
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 1

  template:
    metadata:
      labels:
        app: simple-devops-project
    spec:
      containers:
      - name: simple-devops-project
        image: duclpminh/simple-devops-image
        imagePullPolicy: Always
        ports:
        - containerPort: 8080
---

#########

*k8s-service.yml
---
apiVersion: v1
kind: Service
metadata:
  name: simple-devops-service
  labels:
    app: simple-devops-project
spec:
  selector:
    app: simple-devops-project
  type: LoadBalancer
  ports:
    - port: 8080
      targetPort: 8080
      nodePort: 31200
---
